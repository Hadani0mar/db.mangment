# ما يتم تخزينه في Supabase

## الجداول الموجودة

### 1. جدول `user_database_connections`
هذا الجدول يحتوي على معلومات اتصال قاعدة البيانات الخاصة بكل مستخدم.

#### الحقول المخزنة:

| الحقل | النوع | الوصف |
|------|------|-------|
| `id` | UUID | معرف فريد للسجل |
| `user_id` | UUID | معرف المستخدم من Supabase Auth |
| `server_name` | TEXT | اسم السيرفر (مثل: "MyServer") |
| `server_address` | TEXT | عنوان السيرفر (مثل: "localhost" أو IP) |
| `database_name` | TEXT | اسم قاعدة البيانات (مثل: "InfinityRetailDB") |
| `username` | TEXT | اسم المستخدم لقاعدة البيانات |
| `password_encrypted` | TEXT | **كلمة المرور (مشفرة - محفوظة في Supabase فقط)** |
| `sql_server_version` | TEXT | نسخة SQL Server (مثل: "15.0.2000") |
| `sql_server_full_version` | TEXT | النسخة الكاملة لـ SQL Server |
| `is_active` | BOOLEAN | هل الاتصال نشط أم لا |
| `last_connected_at` | TIMESTAMP | آخر مرة تم الاتصال فيها |
| `created_at` | TIMESTAMP | تاريخ الإنشاء |
| `updated_at` | TIMESTAMP | تاريخ آخر تحديث |

#### الأمان:
- **كلمة المرور محفوظة في Supabase فقط** - لا يتم إرجاعها أبداً من API
- يتم استخدام Row Level Security (RLS) لحماية البيانات
- كل مستخدم يمكنه رؤية وتعديل بياناته فقط

#### الاستخدام:
- عند إنشاء اتصال جديد بقاعدة البيانات، يتم حفظ المعلومات في هذا الجدول
- عند تسجيل الدخول، يتم جلب معلومات الاتصال من هذا الجدول
- عند تنفيذ التقارير، يتم استخدام معلومات الاتصال من هذا الجدول

## البيانات التي لا يتم تخزينها في Supabase

### البيانات المحفوظة محلياً (LocalStorage/Cookies):
- إعدادات الجدولة للتقارير (`getReportSchedule`, `setReportSchedule`)
- بيانات التنفيذ الأخير للتقارير (`last_report_execution_*`, `next_report_execution_*`)
- موافقة الكوكيز (`cookieConsent`)
- معلومات الاتصال المؤقتة (في الكوكيز للوصول السريع)

### البيانات المؤقتة:
- نتائج التقارير (يتم جلبها من قاعدة البيانات المحلية عند الطلب)
- بيانات الجلسة (Session) - يتم إدارتها عبر Supabase Auth

## ملاحظات مهمة

1. **الأمان**: كلمة مرور قاعدة البيانات محفوظة في Supabase فقط ولا يتم إرسالها إلى المتصفح
2. **الخصوصية**: كل مستخدم يرى فقط بياناته الخاصة
3. **الأداء**: يتم استخدام Cookies للتخزين المؤقت لتسريع الوصول
4. **التشفير**: كلمات المرور يجب أن تكون مشفرة في Supabase (يُنصح باستخدام Supabase Encryption)

